---
title: "Solar Panel Proposal"
author: "Tyler Chia"
output:
  html_document:
    theme: darkly
---

## I: Abstract
As we enter the 3rd decade of the 21st century, the disastrous effects of climate change are becoming more and more clear and at some point, will become irreversible.  According to NASA, carbon dioxide levels are the highest they have been in 650,000 years and the global temperature has risen 2 degrees Fahrenheit since 1880.  In addition, the polar ice sheets are losing 427 billion metric tons per year and sea level rises 3.3 millimeters per year.  Scientists have reported that global temperatures could reach an irreversible tipping point by 2030 if drastic measures are not taken to slow down the rapidly occurring climate change.  In addition to environmental impact assessment, mitigation strategies must be set into place in order to insure that future generations will continue to be able to live on a habitable planet.

*****

## II: Introduction
One way to minimize the amount of carbon released into the atmosphere is through the use of solar panels as a source of renewable energy.  In this project, using a combination of data science methods and thorough research, I will propose a mitigation strategy that requires certain homeowners, based on the purchase price of their house, to install solar panels as a way of reducing carbon emissions.  I will first use a dataset containing the annual number of metric tons of carbon emissions for certain cities in the United States.  While it would be interesting to see the carbon emissions from every city in the U.S. this project will be on a smaller scale, only looking at prominent cities across the country.  I will then look at more data containing median housing prices for these same specific cities.  Exploring the data and using basic math will allow me to find the percentage change in carbon emissions per city as an indicator of how well my proposal will work.  In the end, I would like to see the percentage change in carbon emissions per city if certain housing owners are required to install solar panels.

*****

## III: Data
The dataset that I used was from the CDP which is an international non-profit organization based in the United Kingdom, Germany, and the U.S.  The main purpose of the company is to help companies and cities disclose the environmental impact of major corporations.  The data came as a CSV file and has 187 observations for the 187 cities in the dataset.  In addition, the data has 16 variables.

- Account Number
- City Name
- Country
- City Short Name
- C40
- Reporting Year
- Measurement Year
- Primary Methodology
- Methodology Details
- Total City-Wide Emissions in Metric Tons of CO2
- Increase/Decrease From Last Year
- Reason for Increase/Decrease
- Current Population Year
- Population
- City Location
- Country Location

The main variables that I will be looking at are the City Name, Country, Total City-Wide Emissions of CO2, Population, and City Location.

*****

## IV: Exploratory Data Analysis

### IV.I: Emissions Data

```{r, echo=F, message=F, warning=F}
library(tidyverse)
library(sf)
library(readr)
library(USAboundaries)
library(USAboundariesData)
library(rnaturalearth)
library(rnaturalearthdata)
```

```{r, echo=F, message=F, warning=F}
emissions <- read_csv("~/github/Solar-Panel-Proposal/data/2016_-_Citywide_Emissions__Map.csv")

emissions = emissions %>% 
  separate(`City Location`, c('Lat', 'Long'), sep = ",")

emissions$Lat <- substring(emissions$Lat, 2)
emissions$Long <- substr(emissions$Long, 1, nchar(emissions$Long)-1)

emissions$Lat = as.numeric(emissions$Lat)
emissions$Long = as.numeric(emissions$Long)

```

```{r, echo=F, message=F, warning=F}
no_cities = emissions %>% 
  group_by(Country) %>% 
  summarise(Number_of_Cities = n())

knitr::kable(no_cities, caption = "Number of Cities with Observations Per Country", col.names = c("Country","Number of Cities"))
```

*****

I first wanted to see how many cities from each country reported their emissions for 2016.  Both the chart above and the graph below display this statistic.  It is clear that out of the 187 cities that reported their carbon emissions in 2016, the United States has the most cities in this dataset at 63 cities.  Other notable cities include Brazil, Canada, Italy, and Portugal.

*****

<center>
```{r, echo=F, message=F, warning=F}
ggplot(data = no_cities, aes(x = Country, y= Number_of_Cities), las=2) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  labs(x = 'Country',
       y = 'Number of Cities',
       title = 'Total Number of Cities that Reported Their Annual Emissions in 2016',
       caption = 'Based on CDP Dataset')
```
</center>

*****

Doing a quick arrangement of the data allows me to see what cities within this 2016 dataset produced the most carbon emissions.  Aside from New York City, it appears that the majority of these cities are located in Asia, which is good to note.

*****

```{r, echo=F, message=F, warning=F}
top5 = emissions %>% 
  select(`City Short Name`, Country, `Total City-wide Emissions (metric tonnes CO2e)`) %>% 
  arrange(-`Total City-wide Emissions (metric tonnes CO2e)`) %>% 
  head(5)

knitr::kable(top5, caption = "Top 5 Cities with Most CO2 Emissions", col.names = c("City","Country","Total City-Wide Emissions (metric tonnes CO2e)"), "simple")
```

*****

After looking at the dataset a little more, I wanted to plot the location of all these cities on a map so I could see if there were any trends in terms of location for the cities that reported their emissions.  However, I noticed that the city location variable in the dataset was one long string containing both the longitude and latitude coordinate.  Because of this, I was forced to split the column into two separate variables: Longitude and Latitude.  After this, I removed the parenthesis from the columns so my data was ready to be plotted on a world map. 

*****

<center>
```{r, echo=F, message=F, warning=F}
hos_sf = st_as_sf(emissions, coords = c("Long", "Lat"), crs = 4326)

world = ne_countries(scale = 'medium', returnclass = 'sf') %>% 
  st_transform(4326)

ggplot(data = world) +
  geom_sf() +
  geom_sf(data = hos_sf, color = "red") +
  labs(title = "Cities That Disclosed Their City-Wide Emissions in 2016",
       x = "Longitude",
       y = "Latitude",
       caption = "Taken from 2016 Citywide Emissions Dataset")
```
</center>

*****

Once I plotted all the cities in the dataset, I moved on to the next step which was to isolate all the United States cities as these are the cities that I will be looking at when comparing them to housing data.  Once I separated all 63 of the U.S. cities from the rest of them, I went ahead and plotted them on a map of the continental United States due to the fact that no cities in Alaska, Hawaii, or Puerto Rico were reported in the dataset.

*****

<center>
```{r, echo=F, message=F, warning=F}
USA = USAboundaries::us_states() %>% 
  st_transform(4326) %>% 
  filter(name != 'Alaska' & name != 'Puerto Rico' & name != 'Hawaii')

counties = USAboundaries::us_counties() %>% 
  st_transform(4326) %>% 
  filter(state_name != 'Alaska' & state_name != 'Puerto Rico' & state_name != 'Hawaii')

us_emissions <- hos_sf %>% 
  filter(Country == 'USA')

ggplot() +
  geom_sf(data = USA, color = "blue") +
  geom_sf(data = us_emissions, color = "red") +
  coord_sf(datum = st_crs(us_emissions)) +
  labs(title = "U.S. Cities That Disclosed Their City-Wide Emissions in 2016",
       x = "Longitude",
       y = "Latitude",
       caption = "Taken from 2016 Citywide Emissions Dataset")
```
</center>

*****

I then wanted to see which cities in the United States were producing the most carbon emissions according to this 2016 dataset.  From what I can tell, all these top 5 cities are high in population and are pretty industrial cities.

*****

```{r, echo=F, message=F, warning=F}
top5US = emissions %>% 
  filter(Country == 'USA') %>% 
  select(`City Short Name`, Country, `Total City-wide Emissions (metric tonnes CO2e)`) %>% 
  arrange(-`Total City-wide Emissions (metric tonnes CO2e)`) %>% 
  head(5)

knitr::kable(top5US, caption = "Top 5 U.S. Cities with Most CO2 Emissions", col.names = c("City","Country","Total City-Wide Emissions (metric tonnes CO2e)"), "simple")
```

*****

Next, I wanted to see which cities had the most emissions per capita in order to determine if there was a relationship between the amount of CO2 emissions and the population.  This population portion of the dataset was taken from different years with the earliest being 2010 and the latest being 2016.  As you can see in the chart below, the only city that remains from the top 5 from the previous chart is Las Vegas, Nevada.

*****

```{r, echo=F, message=F, warning=F}
USAemissions = emissions %>% 
  filter(Country == 'USA')

top5percapita = USAemissions %>% 
  mutate(Per_Capita = `Total City-wide Emissions (metric tonnes CO2e)` / `Current Population`) %>% 
  select(`City Short Name`, `Total City-wide Emissions (metric tonnes CO2e)`, `Current Population Year`, `Current Population`, Per_Capita) %>% 
  arrange(-Per_Capita) %>% 
  head(5)
  
knitr::kable(top5percapita, caption = "Top 5 U.S. Cities with Most CO2 Emissions Per Capita", col.names = c("City","Total City-Wide Emissions (metric tonnes CO2e)", "Current Population Year", "Current Population", "CO2 Tonnes Per Capita"), "simple")
```

*****

### IV.II: Housing Data
For the housing portion of the data, obviously it would be impossible to find a dataset with the exact sales price of each house in each city.  For that reason, as an alternative, I will be using Zillow.com in order to gain a rough estimate of the average price of what the average price of housing in each city is. I will be using Zillow's Home Value Index.  According to Zillow's website, this index value is seasonally adjusted and only includes the middle price tier of homes.  I took the most recent value they had on the site which was updated September 30, 2020.  I will create a new vector for house prices and add that to the dataframe.  Let us look at the top 5 cities in this dataset with the highest and lowest average price for housing.

```{r, echo=F, message=F, warning=F}
prices <- c(753653, 67303, 354073, 479166, 1050747, 177683, 426750, 264923, 198162, 594405, 702173, 709630, 233312, 165692, 2113927, 711361, 180611, 357731, 400251, 238156, 196902, 770097, 259906, 189889, 754942, 549387, 466601, 296590, 213420, 156106, 675496, 656990, 274122, 42486, 659598, 278816, 73686, 641121, 457166, 259906, 296251, 4398248, 768046, 198764, 301333, 298039, 240091, 632271, 804577, 3062157, 190654, 200306, 2237911, 906839, 139496, 190589, 409375, 249656, 1405199, 1684427, 773508, 731656, 219800)

USAemissions$Price <- prices

top5price = USAemissions %>% 
  select(`City Short Name`, `Total City-wide Emissions (metric tonnes CO2e)`, Price) %>% 
  arrange(-Price) %>% 
  head(5)
bot5price = USAemissions %>% 
  select(`City Short Name`, `Total City-wide Emissions (metric tonnes CO2e)`, Price) %>% 
  arrange(Price) %>% 
  head(5)

knitr::kable(top5price, caption = "Top 5 Most Expensive Cities for Housing", col.names = c("City","Total City-Wide Emissions (metric tonnes CO2e)", "Average Housing Price"),"simple")
knitr::kable(bot5price, caption = "Top 5 Most Cheapest Cities for Housing", col.names = c("City","Total City-Wide Emissions (metric tonnes CO2e)", "Average Housing Price"),"simple")
```

*****

Next, I need to add in the total number of houses in each city.  I will create another vector for housing count and add it to the dataframe.  In the chart below, I will display the cities in the dataframe with the most houses.  Disclaimer: all of the housing counts are taken from the United States Census Bureau under households from 2014-2018.  It should be noted that these housing counts are rough estimates.

*****

```{r, echo=F, message=F, warning=F}
housecount <- c(6878, 11492, 68855, 264428, 1821, 42037, 370043, 123444, 497794, 6456, 47768, 24597, 29975, 335373, 3079, 8979, 352543, 16197, 23610, 505816, 848340, 42643, 20841, 41207, 104716, 74848, 294258, 199478, 79579, 238436, 503463, 11130, 13436, 260383, 266247, 1056118, 169365, 281322, 65737, 22118, 226396, 3053, 1373864, 15468, 173916, 268061, 154036, 3154103, 161483, 26212, 53187, 594778, 3948, 23538, 140455, 136275, 98844, 89846, 359673, 45487, 323446, 32851, 210816)

USAemissions$Num_Houses <- housecount

top5count = USAemissions %>% 
  select(`City Short Name`, `Total City-wide Emissions (metric tonnes CO2e)`, Num_Houses) %>% 
  arrange(-Num_Houses) %>% 
  head(5)

knitr::kable(top5count, caption = "Top 5 Cities With Most Houses", col.names = c("City","Total City-Wide Emissions (metric tonnes CO2e)", "Number of Households"),"simple")
```

*****

## V: Analysis and Discussion
In order to perform any real analysis on this data and determine magnitude of the effects of solar panels on carbon emissions, I first need to research the average price of solar panel installation.  In addition, I will need to understand how much less CO2 emissions are produced when using a single solar panel as opposed to using normal electricity.  With this information I will be able to calculate the ratio of solar panel costs to housing price per city in order to determine in which cities it is financially feasible to enforce a solar panel installation requirement.  The amount of CO2 emissions saved by using solar panels will allow me to simply calculate the percentage change per city in CO2 emissions if certain households are required to install these panels.  In addition, I can calculate the change in carbon emissions in all 63 of these reported U.S. cities if everyone was required to install solar panels.


*****

## VI: Conclusion

*****

## VII: References
1. https://data.cdp.net/Emissions/2016-Citywide-Emissions-Map/iqbu-zjaj
2. https://climate.nasa.gov/
3. https://abcnews.go.com/International/united-nations-report-details-looming-climate-crisis/story?id=58354235
4. https://www.zillow.com/
5. https://www.point2homes.com/US/Neighborhood/IL/Lake-Forest-Demographics.html
6. https://www.neighborhoodscout.com/il/alton/real-estate
7. https://www.census.gov/quickfacts/
8. https://en.wikipedia.org/wiki/Brisbane,_California
9. 

*****

## VIII: Appendix

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```

